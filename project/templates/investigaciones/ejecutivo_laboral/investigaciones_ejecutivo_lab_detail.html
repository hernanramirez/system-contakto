{% extends 'partials/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock title %}


{% block content %}

<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">

            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                        <h4 class="mb-sm-0 font-size-18">Investigaciones</h4>

                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                                <li class="breadcrumb-item ">
                                    <a href="{% url 'investigaciones:investigaciones_list' %}">
                                        Inv. Coord. Ejecutivo
                                    </a>
                                </li>
                                <li class="breadcrumb-item active">Detalle de investigación</li>
                            </ol>
                        </div>

                    </div>
                </div>
            </div>
            <!-- end page title -->


            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title">Detalle de investigación</h3>

                            <div class="row">

                                <div class="col-md-3">
                                    <strong>Tipo de investigación(es):</strong>

                                    
                                    {% for ti in investigacion.tipo_investigacion.all  %}    
                                    {{ ti }}
                                    {% endfor %}
                                        
                                </div>

                                <div class="col-md-3">
                                    <strong>Cliente:</strong>
                                    {{ investigacion.compania }}
                                </div>

                                <div class="col-md-3">
                                    <strong>Sucursal:</strong>
                                    {{ investigacion.sucursal }}
                                </div>

                                <div class="col-md-3">
                                    <strong>Contacto:</strong>
                                    {{ investigacion.contacto }}
                                </div>

                            </div>

                        </div>
                    </div>
                </div><!-- end col -->

            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title">



                                {% if investigacion.candidato_validado %}

                                <button type="button" class="btn btn-soft-success waves-effect waves-light"><i
                                        class="bx bx-check-double font-size-16 align-middle"></i></button>

                                {% else %}

                                <button type="button" class="btn btn-soft-danger waves-effect waves-light"
                                    data-bs-toggle="popover" title="Data incompleta"
                                    data-bs-content="Se debe completar los datos del candidato, "><i
                                        class="bx bx-block font-size-16 align-middle"></i></button>

                                {% endif %}

                                Datos del candidato

                            </h3>

                            <div class="row">
                                <div class="col-md-3">
                                    <strong>Nombres:</strong>
                                    {{ investigacion.candidato.nombre }} {{ investigacion.candidato.apellido }}
                                </div>
                                <div class="col-md-3">
                                    <strong>NSS:</strong>
                                    {{ investigacion.candidato.nss }}
                                </div>
                                <div class="col-md-3">
                                    <strong>Teléfono móvil:</strong>
                                    {{ investigacion.cliente_solicitud_candidato.telefono_movil }}
                                </div>
                                <div class="col-md-3">
                                    <strong>CURP:</strong>
                                    {{ investigacion.candidato.curp }}
                                </div>

                            </div>

                            <br>


                            <a href="{% url 'investigaciones:investigacion_candidato_edit' investigacion.id %}"
                                class="btn btn-primary waves-effect btn-label waves-light">
                                <i class="bx bx-edit label-icon"></i>
                                Editar datos del candidato
                            </a>

                        </div>
                    </div>
                </div><!-- end col -->

            </div>


            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title">

                                <!-- <button type="button" class="btn btn-soft-success waves-effect waves-light"><i class="bx bx-check-double font-size-16 align-middle"></i></button> -->
                                <button type="button" class="btn btn-soft-danger waves-effect waves-light"
                                    data-bs-toggle="popover" title="Data incompleta"
                                    data-bs-content="Se debe agragar al menos una investigacion laboral "><i
                                        class="bx bx-block font-size-16 align-middle"></i></button>
                                Investigación Laboral

                            </h3>

                            <br />

                            <h5>Empresas investigadas</h5>

                            <div class="table-rep-plugin">
                                <div class="table-responsive mb-0" data-pattern="priority-columns">

                                    <table class="table table-striped table-bordered table-hover table-sm">

                                        <thead>
                                            <tr>
                                                <th>Acciones</th>
                                                <th>Empresa</th>
                                                <th>Fecha de Ingreso</th>
                                                <th>Fecha de Egreso </th>
                                                <th>Puesto</th>
                                                <th>Motivo de baja</th>
                                                <th>Terminada</th>
                                                <th>Visible en Estatus</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for tl in tajectorias_laborales %}
                                            <tr>
                                                <td style="text-align: center;">
                                                    <a href="{% url 'investigaciones:investigacion_persona_trayectoria_laboral_edit' investigacion.id tl.pk %}"
                                                        class="btn btn-soft-primary waves-effect waves-light"><i
                                                            class="bx bx-edit font-size-16 align-middle"></i>
                                                    </a>
                                                </td>
                                                <td>
                                                    {{ tl.compania.nombre }} <br />
                                                    <small>{{ tl.observaciones_generales|lower }}</small>
                                                </td>
                                                <td class="{% if not tl.periodo_alta %}text-danger{% endif %}">
                                                    {% if tl.periodo_alta %}
                                                    {{tl.periodo_alta}}
                                                    {% else %}
                                                    <b>Sin Dato</b>
                                                    {% endif %}
                                                </td>
                                                <td class="{% if not tl.periodo_baja %}text-danger{% endif %}">
                                                    {% if tl.periodo_baja %}
                                                    {{tl.periodo_baja}}
                                                    {% else %}
                                                    <b>Sin Dato</b>
                                                    {% endif %}
                                                </td>
                                                <td>{{tl.puesto_final}}</td>
                                                <td>{{tl.datosgenerales.motivo_salida|default:''}}</td>


                                                <td class="text-center">
                                                    <i
                                                        class="fa fa-{% if tl.terminada %}check{% else %}times{% endif %}"></i>
                                                </td>
                                                <td class="text-center">
                                                    <i
                                                        class="fa fa-{% if tl.visible_en_status %}check{% else %}times{% endif %}"></i>
                                                </td>

                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <a href="{% url 'investigaciones:investigacion_persona_trayectoria_laboral_create' investigacion.id %}"
                                class="btn btn-primary waves-effect btn-label waves-light">
                                <i class="bx bx-plus label-icon"></i>
                                Agregar datos de investigación laboral
                            </a>

                            <br /><br />

                            <h5>Referencias Comerciales</h5>

                            <table class="table table-striped table-bordered table-hover table-sm">
                                <thead>
                                    <tr>
                                        <th>Tipo de Negocio</th>

                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for referencia in tajectorias_comerciales %}
                                    <tr>
                                        <td>{{ referencia.tipo_negocio }}</td>
                                        <td>
                                            <a href="{% url 'investigaciones:investigacion_persona_trayectoria_comercial_create' investigacion.id referencia.id %}"
                                                class="btn btn-primary waves-effect btn-label waves-light">
                                                <i class="bx bx-edit label-icon"></i>
                                                Editar
                                            </a>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="2">No hay registros</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                            <a href="{% url 'investigaciones:investigacion_persona_trayectoria_comercial_create' investigacion.id 0 %}"
                                class="btn btn-primary waves-effect btn-label waves-light">
                                <i class="bx bx-plus label-icon"></i>
                                Agregar referencia Laboral</a>

                            <br />
                            <br />

                            Observaciones de Estatus de Inv. Laboral (visible en conclusión pdf)


                            <br /><br />



                            <!-- <a href="{% url 'investigaciones:investigacion_persona_trayectoria_laboral_create' investigacion.id %}"
                                class="btn btn-primary waves-effect waves-light">
                                <i class="bx bx-plus font-size-16 align-middle me-2"></i>
                                Completar la investigación laboral
                            </a> -->



                        </div>
                    </div>
                </div><!-- end col -->

            </div>


            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title">Bitácora</h3>

                            <div class="row">

                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered table-hover" id="datatable">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Usuario</th>
                                                    <th>Servicio</th>
                                                    <th>Observaciones</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for bitacora in bitacoras %}
                                                <tr>
                                                    <td>{{ bitacora.datetime }}</td>
                                                    <td>{{ bitacora.user }}</td>
                                                    <td>{{ bitacora.servicio }}</td>
                                                    <td>{{ bitacora.observaciones }}</td>
                                                </tr>

                                                {% empty %}
                                                <tr>
                                                    <td colspan="4">No hay bitacoras para esta investigación</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>

                                        <a href="{% url 'investigaciones:investigacion_candidato_edit' investigacion.id %}"
                                            class="btn btn-primary waves-effect btn-label waves-light">
                                            <i class="bx bx-plus label-icon"></i>
                                            Agregar bitácora</a>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div><!-- end col -->

            </div>


            <a href="{% url 'investigaciones:investigaciones_ejecutivo_laboral_list' %}"
                class="btn btn-primary waves-effect btn-label waves-light"> <i class="bx bx-arrow-back label-icon"></i>
                Regresar al listado</a>

            <br /><br />


        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->


    {% block footer %}
    {% include 'partials/footer.html' %}
    {% endblock footer %}
</div>
<!-- end main content-->
{% endblock content %}


{% block extra_js %}

<script>
    $(document).ready(function () {
        $('[data-toggle="popover"]').popover();
    });
</script>

{% endblock extra_js %}